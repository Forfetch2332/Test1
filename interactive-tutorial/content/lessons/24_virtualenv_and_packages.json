{
  "title": "Виртуальные окружения и зависимости (pip, venv)",
  "summary": "Как создавать и использовать виртуальные окружения в Python, управлять зависимостями через pip, фиксировать зависимости и основы файлов requirements.txt и pyproject.toml.",
  "text": [
    "Виртуальное окружение — изолированная копия интерпретатора Python с собственным набором установленных пакетов. Оно позволяет проектам иметь разные версии библиотек и не конфликтовать с глобально установленными пакетами.",
    "Создавать окружение можно стандартным модулем venv: python -m venv .venv создаёт папку .venv с отдельным интерпретатором и скриптами для активации. Альтернатива — сторонний инструмент virtualenv, который даёт похожее поведение и работает со старыми версиями Python.",
    "Активация окружения различается по платформам: на Windows это .venv\\Scripts\\activate, на Unix-подобных системах source .venv/bin/activate. После активации pip и python будут ссылаться на пакеты внутри окружения. Выход из окружения выполняется командой deactivate.",
    "pip — стандартный менеджер пакетов для установки, обновления и удаления библиотек из PyPI и других репозиториев. Основные команды: pip install <package>, pip install -r requirements.txt, pip uninstall <package>, pip list, pip show <package>, pip freeze.",
    "Файл requirements.txt фиксирует внешние зависимости проекта. Обычно его формируют командой pip freeze > requirements.txt, а устанавливают pip install -r requirements.txt. В production чаще используют точные версии (package==1.2.3) или ограничения (package>=1.2,<2.0) для детерминированности.",
    "pyproject.toml — современный формат конфигурации сборки и зависимостей (PEP 518/621). Инструменты управления проектами (poetry, pip-tools, setuptools) используют pyproject.toml для описания метаданных и зависимостей; для простых проектов достаточно requirements.txt, но для пакетирования предпочтительнее pyproject.toml.",
    "Практики: хранить виртуальное окружение вне репозитория (добавлять .venv в .gitignore), фиксировать версии зависимостей и тестировать обновления в отдельной ветке. Для воспроизводимости окружения можно использовать pip-tools (pip-compile/pip-sync) или Poetry, которые генерируют lock-файлы с точными версиями.",
    "Editable install (pip install -e .) удобно при разработке библиотек: код проекта подключается в окружение в режиме разработки, и изменения в исходниках сразу видны без переустановки пакета.",
    "Советы по безопасности и надёжности: обновляй pip (python -m pip install --upgrade pip), используй виртуальные окружения для каждого проекта и избегай установки пакетов глобально или с --user для проектов, которые нужно воспроизводить.",
    "Художественный образ: виртуальное окружение — это персональная мастерская проекта: свои инструменты, полки и правила. Пакеты, установленные внутри, не мешают другим мастерским на том же компьютере."
  ],
  "example": "python -m venv .venv\n# Активация (Unix)\nsource .venv/bin/activate\n# Активация (Windows PowerShell)\n.venv\\Scripts\\Activate.ps1\n\n# Обновить pip и установить пакеты\npython -m pip install --upgrade pip\npip install requests==2.31.0 flask\n\n# Зафиксировать зависимости\npip freeze > requirements.txt\n\n# Установка в новом окружении из файла зависимостей\npython -m venv .venv2\nsource .venv2/bin/activate\npip install -r requirements.txt\n\n# Разработка пакета в editable режиме\npip install -e .\n\n# Пример минимального pyproject.toml (POetry/PEP)\n# [project]\n# name = \"myproj\"\n# version = \"0.1.0\"\n# dependencies = [\"requests>=2.0\"]",
  "notes": [
    {
      "hint": "Создавайте отдельное виртуальное окружение для каждого проекта; не храните окружение в репозитории (добавьте папку окружения в .gitignore)."
    },
    {
      "hint": "Используйте pip freeze > requirements.txt для фиксации текущих версий, и pip install -r requirements.txt для восстановления окружения."
    },
    {
      "hint": "Для детерминированных сборок применяйте lock-файлы (pip-tools, poetry.lock) или инструменты типа pip-compile/pip-sync."
    },
    {
      "hint": "pip install -e . полезен при разработке: позволяет править код без переустановки пакета."
    },
    {
      "hint": "Обновляйте pip через python -m pip install --upgrade pip, чтобы избежать проблем с установкой колёс (wheels) и зависимостей."
    },
    {
      "hint": "pyproject.toml — современный способ описания метаданных проекта; для простых скриптов requirements.txt обычно достаточно."
    },
    {
      "hint": "Не устанавливайте зависимости глобально для проектов: это создаёт конфликты между проектами и затрудняет воспроизведение окружения."
    },
    {
      "hint": "Для CI-пайплайнов воспроизводите окружение из requirements.txt или lock-файла и проводите периодические проверки обновлений зависимостей."
    }
  ]
}
